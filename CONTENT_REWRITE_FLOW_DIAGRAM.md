# 爆款文案改写功能 - 流程图

## 🔄 完整业务流程

```
┌─────────────────────────────────────────────────────────────┐
│                    用户操作流程                              │
└─────────────────────────────────────────────────────────────┘

1. 输入 URL
   ↓
2. 点击"提取" → 提交任务到 QStash
   ↓
3. 等待提取完成 (status: extracted)
   ↓
4. 【新增】显示改写功能区域
   ├─ 选择改写风格 (TikTok/YouTube/小红书/微博)
   ├─ 输入自定义需求（可选，紫色呼吸灯输入框）
   └─ 点击"开始改写"
   ↓
5. 调用 /api/media/rewrite
   ├─ 验证用户和任务
   ├─ 检查积分（8积分）
   ├─ 调用 Gemini 改写服务
   └─ 保存改写结果到 subtitleRewritten
   ↓
6. 显示改写结果
   ├─ 对比滑块（原文 ↔ 改写版）
   ├─ 复制改写版
   ├─ 下载改写版 SRT
   └─ 再次改写（可选）
   ↓
7. 【可选】翻译改写后的文案
   ├─ 选择目标语言
   └─ 点击"开始翻译"
   ↓
8. 下载最终结果
```

---

## 🎨 UI 布局示意

```
┌─────────────────────────────────────────┐
│  Media Extractor                        │
├─────────────────────────────────────────┤
│  [URL 输入框] [提取按钮]                │
├─────────────────────────────────────────┤
│  提取结果展示区域                        │
│  - 视频信息（标题、作者、点赞等）        │
│  - 字幕预览                              │
├─────────────────────────────────────────┤
│  【改写功能区域】（新增）                │
│  ┌───────────────────────────────────┐ │
│  │ 改写风格选择                        │ │
│  │ [TikTok] [YouTube] [小红书] [微博] │ │
│  └───────────────────────────────────┘ │
│  ┌───────────────────────────────────┐ │
│  │ 💜 自定义需求输入框（呼吸灯效果）  │ │
│  │ [输入你的特定改写要求...]          │ │
│  └───────────────────────────────────┘ │
│  [+ 更幽默] [+ 缩短] [+ 专业] [+ Emoji]│
│  [开始改写] 按钮                        │
├─────────────────────────────────────────┤
│  【改写结果展示】（改写完成后显示）      │
│  ┌───────────────────────────────────┐ │
│  │ [原文] ──────●────── [改写版]      │ │
│  │ (对比滑块)                         │ │
│  │                                     │ │
│  │ [原文内容] / [改写版内容]          │ │
│  │ (根据滑块位置切换显示)              │ │
│  └───────────────────────────────────┘ │
│  [复制] [下载 SRT] [再次改写]           │
├─────────────────────────────────────────┤
│  【翻译功能区域】（现有）                │
│  [语言选择器] [开始翻译]                 │
└─────────────────────────────────────────┘
```

---

## 🔧 技术架构

```
Frontend (MediaExtractor)
  ↓
useMediaRewrite Hook
  ↓
POST /api/media/rewrite
  ↓
GeminiTranslator.rewriteSubtitle()
  ↓
Gemini API (流式/非流式)
  ↓
保存到 subtitleRewritten 字段
  ↓
返回改写结果
  ↓
前端展示（对比滑块）
```

---

## 📊 数据流

```
提取阶段:
  subtitleRaw (原始字幕)
    ↓
改写阶段:
  subtitleRewritten (改写后的字幕)
    ↓
翻译阶段（可选）:
  subtitleTranslated (翻译后的字幕)
    - 可以选择翻译原文或改写版
```

---

## 💰 积分消耗流程

```
提取: 10 积分
  ↓
改写: 8 积分（新增）
  ↓
翻译: 5 积分（可选）

总成本:
- 提取 + 改写: 18 积分
- 提取 + 改写 + 翻译: 23 积分
```

---

## 🎯 关键特性

### 1. 改写风格模板

- **TikTok**: 前3秒黄金钩子、强节奏感、高频情绪词
- **YouTube**: 结构化内容、长线逻辑、干货密度大
- **小红书**: 种草文案、emoji 丰富、互动性强
- **微博**: 热点结合、话题性强、网络流行语

### 2. 自定义需求

- 用户输入框（紫色呼吸灯效果）
- 快捷标签（更幽默、缩短、专业等）
- 混合模式（模板 + 自定义）

### 3. 结果展示

- 对比滑块（原文 ↔ 改写版）
- 实时切换查看
- 复制和下载功能

---

**流程图设计完成** ✅
