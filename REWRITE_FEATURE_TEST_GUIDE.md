# ğŸ§ª æ”¹å†™åŠŸèƒ½æµ‹è¯•æŒ‡å—

**æµ‹è¯•æ—¶é—´**: 2026-01-17  
**çŠ¶æ€**: âœ… æµ‹è¯•è„šæœ¬å·²åˆ›å»º

---

## ğŸ“‹ æµ‹è¯•æ­¥éª¤

### æ­¥éª¤ 1: å¯åŠ¨å¼€å‘æœåŠ¡å™¨

å¼€å‘æœåŠ¡å™¨å·²åœ¨åå°å¯åŠ¨ï¼š
- URL: http://localhost:3000
- çŠ¶æ€: è¿è¡Œä¸­

**éªŒè¯æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨**:
```bash
# æ£€æŸ¥ç«¯å£ 3000 æ˜¯å¦è¢«å ç”¨
netstat -ano | findstr :3000
```

æˆ–è®¿é—®: http://localhost:3000

---

### æ­¥éª¤ 2: åˆ›å»ºæµ‹è¯•ä»»åŠ¡

#### æ–¹æ³• 1: é€šè¿‡å‰ç«¯ç•Œé¢ï¼ˆæ¨èï¼‰

1. **è®¿é—®åª’ä½“æå–é¡µé¢**
   - æ‰“å¼€: http://localhost:3000/ai-media-extractor
   - æˆ–æ ¹æ®ä½ çš„è·¯ç”±è®¿é—®ç›¸åº”é¡µé¢

2. **æäº¤æµ‹è¯• URL**
   - TikTok ç¤ºä¾‹: `https://www.tiktok.com/@the_shortcut_tsar/video/7415746564376530950`
   - YouTube ç¤ºä¾‹: `https://www.youtube.com/watch?v=VIDEO_ID`

3. **ç­‰å¾…æå–å®Œæˆ**
   - çŠ¶æ€åº”è¯¥å˜ä¸º: `extracted`
   - è¿›åº¦åº”è¯¥ä¸º: `100%`

4. **è·å–ä»»åŠ¡ ID**
   - æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
   - æŸ¥çœ‹ Network æ ‡ç­¾
   - æ‰¾åˆ° `/api/media/submit` è¯·æ±‚
   - ä»å“åº”ä¸­è·å– `taskId`

#### æ–¹æ³• 2: é€šè¿‡ APIï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰

```bash
# æäº¤ä»»åŠ¡
curl -X POST http://localhost:3000/api/media/submit \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://www.tiktok.com/@the_shortcut_tsar/video/7415746564376530950",
    "outputType": "subtitle"
  }'

# ä»å“åº”ä¸­è·å– taskId
```

---

### æ­¥éª¤ 3: æµ‹è¯•æ”¹å†™åŠŸèƒ½

#### æ–¹æ³• 1: ä½¿ç”¨æµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
pnpm tsx scripts/test-rewrite-feature.ts <taskId> viral zh-CN

# ç¤ºä¾‹
pnpm tsx scripts/test-rewrite-feature.ts abc123 viral zh-CN
```

**æµ‹è¯•è„šæœ¬åŠŸèƒ½**:
- âœ… æ£€æŸ¥ä»»åŠ¡çŠ¶æ€
- âœ… è§¦å‘æ”¹å†™ä»»åŠ¡
- âœ… è½®è¯¢æ£€æŸ¥ç»“æœï¼ˆæœ€å¤š 2 åˆ†é’Ÿï¼‰
- âœ… æ˜¾ç¤ºæ”¹å†™ç»“æœï¼ˆè‹±æ–‡æ¯æœ¬ + ç›®æ ‡è¯­è¨€ï¼‰

#### æ–¹æ³• 2: é€šè¿‡å‰ç«¯ç•Œé¢

1. **æ‰“å¼€ä»»åŠ¡è¯¦æƒ…**
   - åœ¨ä»»åŠ¡åˆ—è¡¨ä¸­ç‚¹å‡» "View Details" æŒ‰é’®

2. **è§¦å‘æ”¹å†™**
   - ç‚¹å‡» "Rewrite Script" æŒ‰é’®
   - é€‰æ‹©é£æ ¼ï¼ˆå¦‚ï¼šViralï¼‰
   - é€‰æ‹©ç›®æ ‡è¯­è¨€ï¼ˆå¦‚ï¼šç®€ä½“ä¸­æ–‡ï¼‰
   - ç‚¹å‡» "Start Rewrite"

3. **è§‚å¯Ÿç»“æœ**
   - åº”è¯¥ç«‹å³æ˜¾ç¤ºåŠ è½½çŠ¶æ€
   - ç­‰å¾… 30-60 ç§’
   - ç»“æœåº”è¯¥è‡ªåŠ¨æ˜¾ç¤ºï¼ˆé€šè¿‡ Realtimeï¼‰

#### æ–¹æ³• 3: é€šè¿‡ APIï¼ˆç›´æ¥æµ‹è¯•ï¼‰

```bash
# è§¦å‘æ”¹å†™
curl -X POST http://localhost:3000/api/media/rewrite \
  -H "Content-Type: application/json" \
  -d '{
    "taskId": "your-task-id",
    "style": "viral",
    "targetLang": "zh-CN"
  }'

# åº”è¯¥è¿”å›: 202 Accepted

# æ£€æŸ¥ç»“æœï¼ˆè½®è¯¢ï¼‰
curl http://localhost:3000/api/media/status?id=your-task-id

# æ£€æŸ¥ rewrittenScripts å­—æ®µ
```

---

## ğŸ” éªŒè¯æ¸…å•

### åŠŸèƒ½éªŒè¯

- [ ] **ä»»åŠ¡çŠ¶æ€æ£€æŸ¥**
  - [ ] ä»»åŠ¡çŠ¶æ€ä¸º `extracted` æˆ– `completed`
  - [ ] ä»»åŠ¡æœ‰ `subtitleRaw` å†…å®¹

- [ ] **æ”¹å†™è§¦å‘**
  - [ ] API è¿”å› `202 Accepted`
  - [ ] ä»»åŠ¡çŠ¶æ€æ›´æ–°ä¸º `processing`
  - [ ] è¿›åº¦æ›´æ–°ä¸º `50%`

- [ ] **æ”¹å†™ç»“æœ**
  - [ ] `rewrittenScripts` å­—æ®µæœ‰æ•°æ®
  - [ ] åŒ…å« `en`ï¼ˆè‹±æ–‡æ¯æœ¬ï¼‰å­—æ®µ
  - [ ] åŒ…å« `target`ï¼ˆç›®æ ‡è¯­è¨€ï¼‰å­—æ®µ
  - [ ] åŒ…å« `style`ã€`lang`ã€`createdAt` å­—æ®µ

- [ ] **å‰ç«¯æ˜¾ç¤º**
  - [ ] RewriteTrigger æŒ‰é’®æ˜¾ç¤º
  - [ ] RewriteDisplay ç»„ä»¶æ˜¾ç¤ºç»“æœ
  - [ ] åŒè¯­å¯¹ç…§æ­£ç¡®æ˜¾ç¤º
  - [ ] å¤åˆ¶åŠŸèƒ½æ­£å¸¸

- [ ] **Realtime æ›´æ–°**
  - [ ] æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º "Received real-time update"
  - [ ] ç»“æœè‡ªåŠ¨æ›´æ–°ï¼Œæ— éœ€åˆ·æ–°é¡µé¢

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æœåŠ¡å™¨æ— æ³•å¯åŠ¨

**ç—‡çŠ¶**: `pnpm dev` æŠ¥é”™æˆ–ç«¯å£è¢«å ç”¨

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :3000

# åœæ­¢å ç”¨è¿›ç¨‹
taskkill /PID <è¿›ç¨‹ID> /F

# é‡æ–°å¯åŠ¨
pnpm dev
```

### é—®é¢˜ 2: æ”¹å†™ä»»åŠ¡ä¸å¯åŠ¨

**ç—‡çŠ¶**: API è¿”å›é”™è¯¯æˆ–è¶…æ—¶

**æ£€æŸ¥é¡¹**:
- [ ] `GEMINI_API_KEY` ç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®
- [ ] ä»»åŠ¡çŠ¶æ€æ˜¯å¦ä¸º `extracted` æˆ– `completed`
- [ ] ä»»åŠ¡æ˜¯å¦æœ‰ `subtitleRaw` å†…å®¹
- [ ] ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

### é—®é¢˜ 3: æ”¹å†™ç»“æœä¸æ˜¾ç¤º

**ç—‡çŠ¶**: ä»»åŠ¡å®Œæˆä½†å‰ç«¯ä¸æ˜¾ç¤ºç»“æœ

**æ£€æŸ¥é¡¹**:
- [ ] Supabase Realtime æ˜¯å¦å¯ç”¨
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
- [ ] `rewrittenScripts` å­—æ®µæ˜¯å¦æ­£ç¡®è§£æ
- [ ] Hook æ˜¯å¦æ­£ç¡®è®¢é˜…

### é—®é¢˜ 4: Gemini API é”™è¯¯

**ç—‡çŠ¶**: æ”¹å†™å¤±è´¥ï¼Œè¿”å› API é”™è¯¯

**æ£€æŸ¥é¡¹**:
- [ ] Gemini API Key æ˜¯å¦æœ‰æ•ˆ
- [ ] API é…é¢æ˜¯å¦å……è¶³
- [ ] ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
- [ ] æœåŠ¡å™¨æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯

---

## ğŸ“Š é¢„æœŸç»“æœ

### æˆåŠŸåœºæ™¯

1. **API å“åº”**
   ```
   Status: 202 Accepted
   Body: { code: 0, message: "ok", data: { success: true, message: "Rewrite task started..." } }
   ```

2. **æ•°æ®åº“æ›´æ–°**
   ```json
   {
     "rewrittenScripts": [
       {
         "style": "viral",
         "en": "1\n00:00:01,000 --> 00:00:03,000\nThis is the English master...",
         "target": "1\n00:00:01,000 --> 00:00:03,000\nè¿™æ˜¯æœ¬åœ°åŒ–ç‰ˆæœ¬...",
         "lang": "zh-CN",
         "createdAt": "2026-01-17T12:00:00.000Z"
       }
     ]
   }
   ```

3. **å‰ç«¯æ˜¾ç¤º**
   - å·¦ä¾§ï¼šEnglish Masterï¼ˆè“è‰²è¾¹æ¡†ï¼‰
   - å³ä¾§ï¼šTarget Languageï¼ˆä¸»è‰²è¾¹æ¡†ï¼‰
   - è‡ªåŠ¨æ›´æ–°ï¼ˆæ— éœ€åˆ·æ–°ï¼‰

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•å‘½ä»¤

```bash
# 1. å¯åŠ¨æœåŠ¡å™¨ï¼ˆå¦‚æœæœªå¯åŠ¨ï¼‰
pnpm dev

# 2. ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨ï¼ˆçº¦ 10-20 ç§’ï¼‰

# 3. åˆ›å»ºæµ‹è¯•ä»»åŠ¡ï¼ˆé€šè¿‡å‰ç«¯æˆ– APIï¼‰

# 4. è¿è¡Œæµ‹è¯•è„šæœ¬
pnpm tsx scripts/test-rewrite-feature.ts <taskId> viral zh-CN
```

---

**æµ‹è¯•æŒ‡å—åˆ›å»ºæ—¶é—´**: 2026-01-17  
**çŠ¶æ€**: âœ… æµ‹è¯•è„šæœ¬å·²åˆ›å»ºï¼Œç­‰å¾…å®é™…æµ‹è¯•
