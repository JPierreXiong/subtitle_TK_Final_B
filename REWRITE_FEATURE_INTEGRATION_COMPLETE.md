# âœ… çˆ†æ”¹æ–‡æ¡ˆåŠŸèƒ½å‰ç«¯é›†æˆå®Œæˆ

**é›†æˆæ—¶é—´**: 2026-01-17  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## âœ… å·²å®Œæˆçš„é›†æˆ

### 1. MediaTaskResult ç»„ä»¶é›†æˆ

**æ–‡ä»¶**: `src/shared/blocks/generator/media-task-result.tsx`

**é›†æˆä½ç½®**: åœ¨ Download Buttons ä¹‹å‰ï¼ŒStatus å’Œ Languages ä¹‹å

**æ·»åŠ çš„ç»„ä»¶**:
- âœ… `RewriteTrigger`: è§¦å‘æ”¹å†™æŒ‰é’®ï¼ˆå¸¦å¯¹è¯æ¡†ï¼‰
- âœ… `RewriteDisplay`: æ˜¾ç¤ºæ”¹å†™ç»“æœï¼ˆåŒè¯­å¯¹ç…§ï¼‰

**æ˜¾ç¤ºæ¡ä»¶**:
- ä»…åœ¨ `status === 'extracted'` æˆ– `status === 'completed'` æ—¶æ˜¾ç¤º
- è‡ªåŠ¨é€šè¿‡ Supabase Realtime æ›´æ–°

---

### 2. API è·¯ç”±æ”¯æŒ

**æ–‡ä»¶**: `src/app/api/media/status/route.ts`

**å·²æ”¯æŒå­—æ®µ**:
- âœ… `rewrittenScripts`: JSONB å­—æ®µè‡ªåŠ¨è§£æä¸ºæ•°ç»„

---

### 3. ç»„ä»¶åŠŸèƒ½

#### RewriteTrigger ç»„ä»¶
- âœ… è§¦å‘æŒ‰é’®ï¼šå¸¦ Sparkles å›¾æ ‡
- âœ… å¯¹è¯æ¡†ï¼šé€‰æ‹©é£æ ¼å’Œç›®æ ‡è¯­è¨€
- âœ… é¢„è®¾é£æ ¼ï¼šViral, Funny, Professional, Casual, Dramatic, Custom
- âœ… æ”¯æŒ 18+ ç§ç›®æ ‡è¯­è¨€
- âœ… çŠ¶æ€æ£€æŸ¥ï¼šä»…åœ¨ä»»åŠ¡å°±ç»ªæ—¶æ˜¾ç¤º

#### RewriteDisplay ç»„ä»¶
- âœ… åŒè¯­å¯¹ç…§æ˜¾ç¤ºï¼šè‹±æ–‡æ¯æœ¬ + ç›®æ ‡è¯­è¨€
- âœ… å®æ—¶æ›´æ–°ï¼šä½¿ç”¨ `useMediaTaskRealtime` Hook
- âœ… åŠ è½½çŠ¶æ€ï¼šæ˜¾ç¤ºæ”¹å†™è¿›åº¦
- âœ… å¤åˆ¶åŠŸèƒ½ï¼šä¸€é”®å¤åˆ¶åˆ°å‰ªè´´æ¿
- âœ… SEO ä¼˜åŒ–ï¼šè‹±æ–‡ç‰ˆæœ¬çªå‡ºæ˜¾ç¤º

---

## ğŸ“‹ ä½¿ç”¨æµç¨‹

### ç”¨æˆ·æ“ä½œæµç¨‹

1. **æå–å­—å¹•**
   - ç”¨æˆ·æäº¤ TikTok/YouTube URL
   - ç­‰å¾…æå–å®Œæˆï¼ˆstatus: `extracted`ï¼‰

2. **è§¦å‘æ”¹å†™**
   - ç‚¹å‡» "Rewrite Script" æŒ‰é’®
   - é€‰æ‹©é£æ ¼ï¼ˆå¦‚ï¼šViralï¼‰
   - é€‰æ‹©ç›®æ ‡è¯­è¨€ï¼ˆå¦‚ï¼šç®€ä½“ä¸­æ–‡ï¼‰
   - ç‚¹å‡» "Start Rewrite"

3. **æŸ¥çœ‹ç»“æœ**
   - API ç«‹å³è¿”å› 202 Accepted
   - å‰ç«¯æ˜¾ç¤ºåŠ è½½çŠ¶æ€
   - é€šè¿‡ Supabase Realtime è‡ªåŠ¨æ¥æ”¶æ›´æ–°
   - åŒè¯­å¯¹ç…§ç»“æœè‡ªåŠ¨æ˜¾ç¤º

---

## ğŸ” æµ‹è¯•éªŒè¯æ­¥éª¤

### 1. æ•°æ®åº“éªŒè¯

```sql
-- æ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'media_tasks' 
AND column_name = 'rewritten_scripts';

-- åº”è¯¥è¿”å›: rewritten_scripts | jsonb
```

### 2. API æµ‹è¯•

```bash
# æµ‹è¯•æ”¹å†™ API
curl -X POST http://localhost:3000/api/media/rewrite \
  -H "Content-Type: application/json" \
  -d '{
    "taskId": "your-task-id",
    "style": "viral",
    "targetLang": "zh-CN"
  }'

# åº”è¯¥è¿”å›: 202 Accepted
```

### 3. å‰ç«¯æµ‹è¯•

1. **æ‰“å¼€ä»»åŠ¡è¯¦æƒ…**
   - è®¿é—®ä»»åŠ¡åˆ—è¡¨é¡µé¢
   - ç‚¹å‡» "View Details" æŒ‰é’®

2. **æ£€æŸ¥ç»„ä»¶æ˜¾ç¤º**
   - âœ… åœ¨ `extracted` æˆ– `completed` çŠ¶æ€æ—¶ï¼Œåº”è¯¥çœ‹åˆ° "Rewrite Script" æŒ‰é’®
   - âœ… ç‚¹å‡»æŒ‰é’®ï¼Œåº”è¯¥å¼¹å‡ºå¯¹è¯æ¡†

3. **æµ‹è¯•æ”¹å†™åŠŸèƒ½**
   - é€‰æ‹©é£æ ¼ï¼šViral
   - é€‰æ‹©è¯­è¨€ï¼šç®€ä½“ä¸­æ–‡
   - ç‚¹å‡» "Start Rewrite"
   - âœ… åº”è¯¥ç«‹å³æ˜¾ç¤ºåŠ è½½çŠ¶æ€
   - âœ… ç­‰å¾… 30-60 ç§’åï¼Œåº”è¯¥è‡ªåŠ¨æ˜¾ç¤ºåŒè¯­å¯¹ç…§ç»“æœ

4. **æµ‹è¯• Realtime æ›´æ–°**
   - æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°
   - æŸ¥çœ‹ `[useMediaTaskRealtime]` æ—¥å¿—
   - âœ… åº”è¯¥çœ‹åˆ° "Received real-time update" æ¶ˆæ¯
   - âœ… ç»“æœåº”è¯¥è‡ªåŠ¨æ›´æ–°ï¼Œæ— éœ€åˆ·æ–°é¡µé¢

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æŒ‰é’®ä¸æ˜¾ç¤º

**å¯èƒ½åŸå› **:
- ä»»åŠ¡çŠ¶æ€ä¸æ˜¯ `extracted` æˆ– `completed`
- ä»»åŠ¡æ²¡æœ‰ `subtitleRaw` å†…å®¹

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ä»»åŠ¡çŠ¶æ€ï¼š`taskData.status`
- æ£€æŸ¥æ˜¯å¦æœ‰å­—å¹•å†…å®¹ï¼š`taskData.subtitleRaw`

### é—®é¢˜ 2: æ”¹å†™ç»“æœä¸æ˜¾ç¤º

**å¯èƒ½åŸå› **:
- Supabase Realtime æœªå¯ç”¨
- `rewrittenScripts` å­—æ®µè§£æå¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ Supabase Replication æ˜¯å¦å¯ç”¨
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
3. æ£€æŸ¥ API è¿”å›çš„ `rewrittenScripts` æ ¼å¼

### é—®é¢˜ 3: API è¿”å› 500 é”™è¯¯

**å¯èƒ½åŸå› **:
- Gemini API Key æœªé…ç½®
- ä»»åŠ¡çŠ¶æ€ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼š`GEMINI_API_KEY`
2. æ£€æŸ¥ä»»åŠ¡çŠ¶æ€ï¼šå¿…é¡»æ˜¯ `extracted` æˆ– `completed`
3. æ£€æŸ¥ä»»åŠ¡æ˜¯å¦æœ‰ `subtitleRaw` å†…å®¹

---

## âœ… éªŒè¯æ¸…å•

- [x] æ•°æ®åº“å­—æ®µå·²æ·»åŠ ï¼ˆ`rewritten_scripts` JSONBï¼‰
- [x] API è·¯ç”±å·²æ”¯æŒ `rewrittenScripts` å­—æ®µ
- [x] RewriteTrigger ç»„ä»¶å·²é›†æˆ
- [x] RewriteDisplay ç»„ä»¶å·²é›†æˆ
- [x] ç»„ä»¶ä½ç½®æ­£ç¡®ï¼ˆåœ¨ Download Buttons ä¹‹å‰ï¼‰
- [x] æ˜¾ç¤ºæ¡ä»¶æ­£ç¡®ï¼ˆä»… `extracted` æˆ– `completed` çŠ¶æ€ï¼‰
- [x] Realtime Hook å·²æ‰©å±•æ”¯æŒ `rewrittenScripts`
- [x] è¯­æ³•æ£€æŸ¥é€šè¿‡

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. **é‡å¯å¼€å‘æœåŠ¡å™¨**
   ```bash
   pnpm dev
   ```

2. **æµ‹è¯•æ”¹å†™åŠŸèƒ½**
   - åˆ›å»ºä¸€ä¸ªæµ‹è¯•ä»»åŠ¡
   - ç­‰å¾…æå–å®Œæˆ
   - æµ‹è¯•æ”¹å†™åŠŸèƒ½

3. **éªŒè¯ Realtime æ›´æ–°**
   - æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—
   - ç¡®è®¤ç»“æœè‡ªåŠ¨æ›´æ–°

---

**é›†æˆå®Œæˆæ—¶é—´**: 2026-01-17  
**çŠ¶æ€**: âœ… ä»£ç å·²å®Œæˆï¼Œç­‰å¾…æµ‹è¯•éªŒè¯
